{% extends "base.html" %}
{% block title %}Лента{% endblock %}

{% block topbar %}
  <div class="container" style="padding:10px 16px; border-top:1px solid var(--border); background:#fff;">
    <form method="get" class="flex" style="align-items:center;">
      <input class="input" style="max-width:360px;" type="text" name="q" placeholder="Искать пользователя (перейдёт в поиск)">
      <input class="input input-inline" type="date" name="date" value="{{ date_q }}">
      <button type="submit">Показать</button>
      <a class="btn-outline" href="{% url 'social:following' %}">Мои подписки</a>
    </form>
  </div>
  <script>
    // перенаправим на страницу поиска пользователей при вводе q
    (function(){
      const form = document.currentScript.previousElementSibling;
      form.addEventListener('submit', function(e){
        const q = form.querySelector('input[name="q"]').value.trim();
        if(q){ e.preventDefault(); window.location.href = "{% url 'social:search' %}?q=" + encodeURIComponent(q); }
      });
    })();
  </script>
{% endblock %}

{% block content %}
  <div class="grid" style="grid-template-columns: 1fr;">
    {% if events %}
      {% for e in events %}
        <div class="card">
          <div class="muted"><strong>{{ e.user.email }}</strong> — {{ e.created_at|date:"d.m.Y H:i" }}</div>
          {% if e.type == "entry_created" %}
            <div>Добавил(а): <em>{{ e.payload.product_name }}</em>{% if e.payload.kind %} — {{ e.payload.kind }}{% endif %} ({{ e.payload.date }})</div>
          {% else %}
            <div>{{ e.type }}</div>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <p>Событий нет.</p>
    {% endif %}
  </div>
{% endblock %}