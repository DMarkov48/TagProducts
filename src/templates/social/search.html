<!doctype html>
<html lang="ru">
<head><meta charset="utf-8"><title>Поиск пользователей</title></head>
<body>
  <p><a href="/">← На главную</a> | <a href="{% url 'social:following' %}">Мои подписки</a> | <a href="{% url 'social:feed' %}">Лента</a></p>
  <h1>Найти пользователей</h1>

  <form method="get">
    <input type="text" name="q" placeholder="Имя, фамилия, e-mail" value="{{ q }}">
    <button type="submit">Искать</button>
  </form>

  {% if q and not users %}
    <p>Никого не найдено.</p>
  {% endif %}

  <ul>
    {% for u in users %}
      <li>
        {% if u.avatar %}<img src="{{ u.avatar.url }}" width="40">{% endif %}
        {{ u.email }}
        {% if u.first_name or u.last_name or u.middle_name %}
          — {{ u.first_name }} {{ u.middle_name }} {{ u.last_name }}
        {% endif %}

        {% if u.id in following_ids %}
          <form method="post" action="{% url 'social:unfollow' user_id=u.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Отписаться</button>
          </form>
        {% else %}
          <form method="post" action="{% url 'social:follow' user_id=u.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">Подписаться</button>
          </form>
        {% endif %}
      </li>
    {% endfor %}
  </ul>
</body>
</html>
