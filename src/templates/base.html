{% load static %}
{% load role_extras %} {# наш тег is_moderator #}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>{% block title %}400 продуктов{% endblock %}</title>

  <!-- Bootstrap 5 (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Grayscale CSS (локально скопированный) -->
  <link href="{% static 'theme/grayscale.css' %}" rel="stylesheet">

  <!-- Ваши кастомные стили -->
  <link href="{% static 'css/base.css' %}" rel="stylesheet">

  {% block head %}{% endblock %}
  <style>
  #mainNav .nav-link,
  #mainNav .navbar-brand {
    color: #000 !important;
  }
  </style>
</head>
<body id="page-top">

<!-- Навбар -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm" id="mainNav">
  <div class="container px-4">
    <a class="navbar-brand fw-bold" href="{% url 'landing' %}">400 продуктов</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
            aria-label="Toggle navigation">Меню <i class="bi-list"></i></button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ms-auto my-2 my-lg-0">
        <li class="nav-item"><a class="nav-link" href="{% url 'products:list' %}">Каталог</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'social:feed' %}">Лента</a></li>
        <li class="nav-item"><a class="nav-link" href="{% url 'diary:index' %}">Дневник</a></li>

        {% if request.user.is_authenticated %}
          <li class="nav-item"><a class="nav-link" href="{% url 'accounts:profile' %}">Личный кабинет</a></li>
        {% else %}
          <li class="nav-item"><a class="nav-link" href="{% url 'accounts:login' %}">Вход</a></li>
          <li class="nav-item"><a class="nav-link" href="{% url 'accounts:register' %}">Регистрация</a></li>
        {% endif %}

        {% if request.user.is_staff %}
          <li class="nav-item"><a class="nav-link" href="{% url 'admin:index' %}">Админка</a></li>
        {% endif %}

        {% is_moderator as can_moderate %}
        {% if can_moderate %}
          <li class="nav-item"><a class="nav-link" href="{% url 'moderation:list' %}">Модерация</a></li>
        {% endif %}
      </ul>
    </div>
  </div>
  {% block topbar %}{% endblock %}
</nav>

<!-- Сообщения -->
<div class="container" style="padding-top:90px;">
  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-{{ m.tags|default:'secondary' }} mt-2">{{ m }}</div>
    {% endfor %}
  {% endif %}
</div>

<!-- Контент -->
<main class="container py-4">
  {% block content %}{% endblock %}
</main>

<!-- Футер -->
<footer class="py-4 bg-light">
  <div class="container text-center small text-muted">© {{ now|date:"Y" }} 400 продуктов</div>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Grayscale JS -->
<script src="{% static 'theme/grayscale.js' %}"></script>
{% block scripts %}{% endblock %}
</body>
</html>