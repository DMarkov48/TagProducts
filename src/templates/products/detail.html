{% extends "base.html" %}
{% block title %}{{ product.name }}{% if product.kind %} — {{ product.kind }}{% endif %}{% endblock %}

{% block content %}
  <div class="flex">
    <div class="product-photo">
      {% if product.photo %}
        <img src="{{ product.photo.url }}" alt="{{ product.name }}">
      {% else %}
        <span class="muted">Нет фото</span>
      {% endif %}
    </div>

    <div class="flex-col" style="flex:1;">
      <h1 style="margin:0 0 6px 0;">{{ product.name }}{% if product.kind %} — {{ product.kind }}{% endif %}</h1>
      <div class="muted">Группа: {{ product.get_group_display }}</div>

      <div style="margin-top:8px;">
        {% for c in product.categories.all %}
          <span class="pill">{{ c.name }}</span>
        {% empty %}
          <span class="muted">Категории не указаны</span>
        {% endfor %}
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="kv">
          <div class="k">Калории (на 100 г):</div><div class="v">{{ product.kcal }}</div>
          <div class="k">Белки:</div><div class="v">{{ product.proteins }}</div>
          <div class="k">Жиры:</div><div class="v">{{ product.fats }}</div>
          <div class="k">Углеводы:</div><div class="v">{{ product.carbs }}</div>
        </div>
      </div>

      {% if request.user.is_authenticated %}
        <div class="card" style="margin-top:12px;">
          <h3 style="margin:0 0 8px 0;">Отметить в дневнике</h3>
          <form method="post" action="{% url 'diary:add' %}">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <div class="flex" style="align-items:center;">
              <label>Дата: <input class="input input-inline" type="date" name="date" value="{{ today|date:'Y-m-d' }}"></label>
              <input class="input input-inline" type="number" name="amount_grams" min="1" step="1" placeholder="граммы (опц.)">
              <input class="input" type="text" name="note" maxlength="240" placeholder="Заметка (опц.)">
              <button type="submit">Съел(а)</button>
            </div>
          </form>
        </div>
      {% else %}
        <a class="btn" href="{% url 'accounts:login' %}?next={{ request.path }}">Войти, чтобы отметить</a>
      {% endif %}
    </div>
  </div>
{% endblock %}